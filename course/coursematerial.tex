\documentclass[12pt,a4paper	,twoside]{article}

% ------------ packages -------------

\usepackage[utf8]{inputenc}
\usepackage[OT1]{fontenc}
\usepackage{graphicx}
\usepackage[english]{babel}

\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsthm}

\usepackage[usenames,dvipsnames]{xcolor}
\usepackage{todonotes}
\usepackage{etoolbox}
\usepackage{url}
\usepackage{enumerate}
%\usepackage{tikz}
%\usetikzlibrary{shapes.misc,fit}

\usepackage[bookmarks]{hyperref}

\newcommand{\reals}{\mathbb{R}}
\newcommand{\posreals}{\reals_{>0}}
\newcommand{\posrealszero}{\reals_{\ge 0}}
\newcommand{\naturals}{\mathbb{N}}

\newcommand{\dd}{\,\mathrm{d}}

\newcommand{\mbf}[1]{\mathbf{#1}}
\newcommand{\bs}[1]{\boldsymbol{#1}}
\renewcommand{\vec}[1]{{\bs#1}}

\newcommand{\uz}{^{(0)}} % upper zero
\newcommand{\un}{^{(n)}} % upper n
\newcommand{\ui}{^{(i)}} % upper i

\newcommand{\ul}[1]{\underline{#1}}
\newcommand{\ol}[1]{\overline{#1}}

\newcommand{\E}{\operatorname{E}}
\newcommand{\V}{\operatorname{Var}}

\newcommand{\ber}{\operatorname{Bernoulli}} 
\newcommand{\bin}{\operatorname{Binomial}}
\newcommand{\be}{\operatorname{Beta}} 
\newcommand{\bebin}{\operatorname{Beta-binomial}} 

\newcommand{\code}[1]{\emph{\ttfamily #1}}

\newtheorem{myex}{Exercise}

\input{nydefs.tex}

\title{Generalized Bayesian Inference\\ with Sets of Conjugate Priors}
\author{Gero Walter}
\date{Lund University, 15.12.2015}

\begin{document}
\maketitle

\section{Bayesian basics}

Bayesian inference allows to combine information from data
and information extraneous to data (e.g., expert information)
into a `complete picture'.
Data $\vec{x}$ is assumed to be generated from a certain parametric distribution family,
and information about unknown parameters is then expressed by a so-called prior distribution,
a distribution over the parameter(s) of the data generating function.

As running example, let us consider an experiment with two possible outcomes,
success and failure. The number of successes $s$ in a series of $n$ independent trials
has then a Binomial distribution with parameters $p$ and $n$,
where $n$ is known but $p \in [0,1]$ is unknown.
In short, $S\mid p \sim \bin(n,p)$, which means
\begin{align*}
f(s\mid p) &= P(S = s \mid p) = {n \choose s} p^s (1-p)^{n-s},\quad s \in \{0, 1, \ldots, n\}\,.
\end{align*}
Information about unknown parameters (here, $p$) is then expressed
by a so-called prior distribution, some distribution with some pdf, here $f(p)$.

The `complete picture' is then the so-called posterior distribution,
here with pdf $f(p\mid s)$, expressing the state of knowledge after having seen the data.
It encompasses information from the prior $f(p)$ and data
and is obtained via Bayes' Rule,
\begin{align}
f(p \mid s) &= \frac{f(s\mid p) f(p)}{\int f(s\mid p) f(p) \dd p}
             = \frac{f(s\mid p) f(p)}{f(s)} \propto f(s\mid p) f(p)\,,
\label{eq:bayesrule}
\end{align}
where $f(s)$ is the so-called marginal distribution of the data $S$.

In general, the posterior distribution is hard to obtain,
especially due to the integral in the denominator.
The posterior can be approximated with numerical methods,
like the Laplace approximation or simulation methods like MCMC (Markov chain Monte Carlo).
There is a large literature dealing with computations of posteriors,
and software like BUGS or JAGS has been developed
which simplifies the creation of a sampler to approximate a posterior.


\section{A conjugate prior}

However, Bayesian inference not necessarily entails complex calculations and simulation methods.
With a clever choice of parametric family for the prior distribution,
the posterior distribution belongs to the same parametric family as the prior,
just with updated parameters.
Such prior distributions are called \emph{conjugate} priors.
Basically, with conjugate priors one trades flexibility for tractability:
The parametric family restricts the form of the prior pdf,
but with the advantage of much easier computations.%
\footnote{In fact, practical Bayesian inference was mostly restricted to conjugate priors before the advent of MCMC.}

The conjugate prior for the Binomial distribution is the Beta distribution,
which is usually parametrised with parameters $\alpha$ and $\beta$.
\begin{align}
f(p\mid\alpha,\beta) &= \frac{1}{B(\alpha,\beta)}\, p^{\alpha-1}\, (1-p)^{\beta-1}\,,
\label{eq:betadensab}
\end{align}
where $B(\cdot,\cdot)$ is the Beta function.%
\footnote{The Beta function is defined as $B(a,b) = \int_0^1 t^{a-1} (1-t)^{b-1} \dd t$
and gives the inverse normalisation constant for the Beta distribution.
It is related to the Gamma function through $B(a,b) = \frac{\Gamma(a)\Gamma(b)}{\Gamma(a+b)}$.
We will not need to work with Beta functions here.}
In short, we write $p \sim \be(\alpha,\beta)$.

From now on, we will denote prior parameter values by an upper index~${}\uz$,
and updated, posterior parameter values by an upper index~${}\un$.
With this notational convention,
let $S\mid p \sim \bin(n,p)$ and $p \sim \be(\az,\bz)$.
Then it holds that $p \mid s \sim \be(\an,\bn)$,
where $\an$ and $\bn$ are updated, posterior parameters, obtained as
\begin{align}
\an &= \az + s\,, & \bn &= \bz + n - s \,.
\label{eq:betapostab}
\end{align}
From this we can see that $\az$ and $\bz$ can be interpreted as pseudocounts,
forming a hypothetical sample with $\az$ sucesses and $\bz$ failures.
\begin{myex}
Confirm \eqref{eq:betapostab}, i.e.,
show that, when $S\mid p \sim \bin(n,p)$ and $p \sim \be(\az,\bz)$,
the density of the posterior distribution for $p$ is of the form \eqref{eq:betadensab}
but with updated parameters.
(Hint: use the last expression in \eqref{eq:bayesrule}
and consider only the terms related to $p$ for the posterior.)
\end{myex}

You have seen in the talk that we considered a different parametrisation of the Beta distribution
in terms of $\nz$ and $\yz$, obtained as
\begin{align}
\nz &= \az + \bz\,, & \yz &= \frac{\az}{\az+\bz}\,,
\label{eq:betareparam}
\end{align}
such that writing $p \sim \be(\nz,\yz)$ corresponds to
\begin{align}
f(p\mid\nz,\yz) &= \frac{p^{\nz\yz-1}\, (1-p)^{\nz(1-\yz)-1}}{B(\nz\yz,\nz(1-\yz))}\,.
\label{eq:betadensny}
\end{align}
In this parametrisation, the updated, posterior parameters are given by
\begin{align}
\nn &= \nz + n\,, &
\yn &= \frac{\nz}{\nz + n} \cdot \yz + \frac{n}{\nz + n} \cdot \frac{s}{n}\,,
\label{eq:betapostny}
\end{align}
and we write $p\mid s \sim \be(\nn,\yn)$.

\begin{myex}
Confirm the equations for updating $\nz$ to $\nn$ and $\yz$ to $\yn$.
(Hint: You can start either from \eqref{eq:betapostab} or \eqref{eq:betadensny}.)
\end{myex}

From the properties of the Beta distribution,
it follows that $\yz = \frac{\az}{\az+\bz} = \E[p]$
is the prior expectation for the success probability $p$,
and that the higher $\nz$, the more probability weight will be concentrated around $\yz$,
as $\V(p) = \frac{\yz (1-\yz)}{\nz + 1}$.
From the interpretation of $\alpha$ and $\beta$ and \eqref{eq:betareparam},
we see that $\nz$ can also be interpreted as a (total) pseudocount or prior strength.

\begin{myex}
Write a function \code{dbetany(x,n,y, ...)}
that returns the value of the Beta density function at \code{x}
for parameters $\nz$ and $\yz$ instead of \code{shape1} ($=\alpha$) and \code{shape2} ($=\beta$)
as in \code{dbeta(x, shape1, shape2, ...)}.
Use your function to plot the Beta pdf for different values of $\nz$ and $\yz$
to see how the pdf changes according to the parameter values.
\end{myex}

The formula for $\yn$ in \eqref{eq:betapostny} is not written in the most compact form
in order to emphasize that $\yn$, the posterior expectation of $p$,
is a weighted average of the prior expectation $\yz$ and $s/n$ (the fraction of successes in the data),
with the weights $\nz$ and $n$, respectively.
We see that $\nz$ plays the same role for the prior mean $\yz$
as the sample size $n$ for the observed mean $s/n$,
reinforcing the interpretation as pseudocount.
Indeed, the higher $\nz$, the higher the weight for $\yz$
in the weighted average calculation of $\yn$,
so $\nz$ gives the strength of the prior as compared to the sample size $n$.

\begin{myex}
Give a ceteris paribus analysis for $\E[p\mid s] = \yn$ and $\V(p\mid s) = \frac{\yn (1-\yn)}{\nn + 1}$
(i.e, discuss how $\E[p\mid x]$ and $\V(p\mid s)$ behave) when
\begin{enumerate}[(i)]
\item $\nz \to 0$,
\item $\nz \to \infty$, and
\item $n\to \infty$ when $s/n = \text{const}$.
\end{enumerate}
and consider also the form of $f(p\mid s)$ based on $\E[p\mid s]$ and $\V(p\mid s)$.
\end{myex}


\section{Conjugate priors for canonical exponential families}

Fortunately it is not necessary to search or guess to find a conjugate prior to a certain data distribution,
as there is a general result on how to construct conjugate priors
when the sample distribution belongs to a so-called \emph{canonical exponential family}
\cite[e.g.,][pp.~202 and 272f]{2000:bernardosmith}. %Def.~4.12 and Prop.~5.6
This result covers many sample distributions, %relevant in a statistician's everyday life,
like Normal and Multinomial models, Poisson models, or Exponential and Gamma models,
and gives a common structure to all conjugate priors constructed in this way.

For the construction, we will consider distributions of i.i.d.\ samples $\vec{x} = (x_1,\ldots,x_n)$ of size $n$ directly.%
\footnote{\label{foot:dataisplural}It would be possible, and indeed is often done in the literature,
to consider a single observation $x$ in \eqref{eq:expofam-sampledens} only,
as the conjugacy property does not depend on the sample size.
However, we find our version with $n$-dimensional i.i.d.\ sample $\vec{x}$
more appropriate.} %, as `data is plural' (kaplan?).}
With the Binomial distribution, we did so indirectly:
It results from $n$ independent trials, which, encoded as $1=$ success and $0=$ failure, form a vector $\vec{x}$.
It turns out that the sample distribution depends on $\vec{x}$ only through $s=\sum_{i=1}^n x_i$:
\begin{align*}
f(\vec{x} \mid p) &= P(\vec{X} = \vec{x}) = \prod_{i=1}^n p^{x_i} (1-p)^{1-x_i} \\
 &= {n \choose s} p^s (1-p)^{n-s} = P(S = s \mid p) = f(s\mid p)
\end{align*}
Such a summary function of a sample $\vec{x}$ is called \emph{a sufficient statistic of $\vec{x}$}.


A sample distribution is said to belong to the \emph{canonical exponential family}
if its density or mass function satisfies the decomposition
\begin{align}
f(\vec{x} \mid \theta) &= a(\vec{x})\exp\big\{\langle \psi, \tau(\vec{x}) \rangle - n \mbf{b}(\psi)\big\}\,,
\label{eq:expofam-sampledens}
\end{align}
where $\psi \in \Psi \subset \reals^q$ is a transformation of the (possibly vectorial) parameter $\theta \in \Theta$,
and $\mbf{b}(\psi)$ a scalar function of $\psi$ (or, in turn, of $\theta$).
$\tau(\vec{x})$ is a function of the sample $\vec{x}$ that fulfills $\tau(\vec{x}) = \sum_{i=1}^n \tau^*(x_i)$,
with $\tau^*(x_i) \in \mathcal{T} \subset \reals^q$,
while $\langle\cdot, \cdot\rangle$ denotes the scalar product.



\end{document}
